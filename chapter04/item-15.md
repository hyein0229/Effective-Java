# Item 15. 클래스와 멤버의 접근 권한을 최소화하라

## ***잘 설계된 컴포넌트란? 객체 지향의 핵심***

- 클래스의 내부 데이터와 내부 구현 정보를 외부 컴포넌트로부터 얼마나 잘 숨겼느냐에 따른다.
- 내부 구현을 숨겨 구현과 API 를 깔끔하게 분리 → **정보 은닉, 혹은 캡슐화**
- 오직 API 를 통해서만 다른 컴포넌트와 소통하고 서로의 내부 동작에 개의치 않는다.
- 서로 독립적이어서 개발, 테스트, 최적화, 적용, 분석, 수정을 개별적으로 할 수 있게 된다.

### 정보 은닉의 장점

- **시스템 개발 속도를 높인다.** 병렬로 개발이 가능해지기 때문이다.
- **시스템 관리 비용을 낮춘다.** 각 컴포넌트의 역할을 더 빨리 파악하여 디버깅이 가능하고, 다른 컴포넌트로 교체하는 부담이 적다.
- **성능 최적화에 도움을 준다.** 다른 컴포넌트에 영향 없이 해당 컴포넌트만 최적화를 진행할 수 있다.
- **소프트웨어 재사용성을 높인다.** 외부 의존 없이 독자적, 독립적으로 동작하는 컴포넌트라면 다른 곳에서도 유용하게 쓰일 가능성이 크다.
- **큰 시스템을 제작하는 난이도를 낮춘다.** 전체 시스템이 완성되지 않아도 단일 컴포넌트의 동작을 검증할 수 있다.

## 자바가 제공하는 정보 은닉을 위한 장치

### 접근 제어 메커니즘

- 클래스, 인터페이스, 멤버의 접근성(접근 허용 범위)을 명시한다.
- 각 요소가 접근성이 그 요소가 선언된 위치와 접근 제한자로 정해진다.
- 따라서, **정보 은닉의 핵심은? 접근 제한자를 제대로 활용하는 것**
- **기본적으로 모든 클래스와 멤버의 접근성을 가능한 한 좁혀야 한다.**
    - 즉, 올바르게 소프트웨어가 동작하는 한 가장 낮은 접근 수준을 사용하자.

---

### package-private 와 public 클래스

- 톱레벨 클래스(가장 바깥), 인터페이스에 부여할 수 있는 접근 수준
- public 클래스는 공개 API 가 된다.
    - **따라서, 패키지 외부에서 사용할 일이 없으면 package-private 로 선언해라.**
    - 공개 API 가 되면 하위 호환을 위해서 영원히 관리해주어야 한다.
    - API 가 아니라면 클라이언트 코드에 영향 없이 내부 구현을 자유롭게 수정할 수 있다.
- package-private 로 선언 시 해당 패키지 내에게서만 사용이 가능하다.

---

### 멤버에 부여할 수 있는 접근 수준

- private: 멤버를 선언한 톱레벨 클래스에서만 접근 가능
- package-private: 멤버가 소속된 패키지 내의 모든 클래스, 기본 적용되는 접근 수준이다.
    - 단, 인터페이스 멤버는 기본 적용 접근 수준이 public 이다.
- protected: package-private 을 포함하여 하위 클래스에서 접근 가능
- public: 모든 곳

## 접근 제한자 부여 시 주의점

- **공개 API 를 설계한 후, 그 외의 모든 멤버는 private 로 만들어라, 다음은 오직 같은 패키지의 다른 클래스가 접근해야 하는 멤버에 대해선 package-private 으로 풀어준다.**
    - 단, 권한을 풀어주는 일이 자주 발생하면 컴포넌트를 더 분해해야 하는 것이 아닌지 고려해야 한다.
    - private 과 package-private 은 내부 구현에 해당하므로 공개 API 에 영향을 주지 않는다.
- Serializable 을 구현한 클래스에선 public 으로 선언하지 않아도 그 필드들도 의도치 않게 공개 API 가 될 수도 있다.
- public 클래스에서 멤버 접근 수준을 package-private 에서 protected 로 바꾸는 순간 멤버에 접근할 수 있는 대상이 엄청 넓어진다. protected 멤버는 공개 API 이므로 영원히 지원되어야 함을 인지해야 한다. 따라서 protected 멤버의 수는 적을수록 좋다.
- 상위 클래스의 메소르를 오버라이딩할 때는 그 접근 수준을 상위 클래스에서보다 좁게 설정할 수 없다.
    - 리스코프 치환 원칙 적용
    - 상위 클래스의 인스턴스는 언제나 하위 클래스의 인스턴스로 대체해 사용할 수 있어야 하기 때문
- 테스트를 위해서 어느정도 접근 범위를 풀어줄 순 있지만 public 은 안된다.
    - public 이 되는 순간 공개 API 가 되버린다.
    - 테스트 대상과 테스트 코드를 같은 패키지에 두면 package-private 만으로 가능하다.
- **public 클래스의 인스턴스 필드는 되도록 public 이 아니어야 한다.**
    - 해당 필드를 누구나 수정하게 되면 해당 필드와 관련된 것들의 불변식을 보장할 수 없게 된다.
    - public 가변 필드를 갖는 클래스는 외부에서 필드를 수정할 수 있도록 하면 필드 수정 시 락 획득과 같은 동기화 제어, 즉 다른 작업을 할 수 없게 되므로 스레드 안전하지 않다.
    - 그러나, 예외는 존재
        - **해당 클래스의 추상 개념을 완성하는데 필요한 상수는 public static final 로 공개해도 좋다.**
        - 관례상 대문자 알파벳 단어와 단어 사이 밑줄(_)으르 넣어 네이밍한다.
        - 단, 기본 타입 값이나 불변 객체를 참조해야 한다. 가변 객체 참조 시 final 로 선언하면 다른 객체 참조는 못해도 해당 객체 자체가 수정될 수 있으므로 끔찍한 결과를 초래할 수 있다.
- **public static final 배열 필드를 두거나 이 필드를 반환하는 접근자 메소드를 제공하면 안된다.**
    - 길이가 0이 아닌 배열은 모두 변경이 가능하다.
    - 클라이언트에서 해당 배열의 내용을 수정하도록 하면 안된다.
    - 해결책은 배열의 접근자를 private 로 하고 복사본 필드를 만들거나 반환하는 메소드를 선언하는 것

## 요약 정리

- 프로그램 요소의 접근성은 가능한 한 최소한으로 하라.
- 꼭 필요한 것만 골라서 공개 API 로 만들어라.
- 의도치 않게 클래스, 인터페이스, 멤버가 API 로 공개되는 것을 주의하라.
- public 클래스는 상수용 public static final 필드 외엔 어떠한 public 필드도 가지면 안된다.
- public static final 필드는 반드시 불변 객체여야 한다. 가변 객체인지 주의해라.